# Instant Snap - Chrome Extension

一个智能的Chrome浏览器插件，可以捕获网页元素并与MCP (Model Context Protocol) 服务通信，实现AI驱动的UI操作。

## 功能特性

### 🎯 智能元素捕获
- **可视化元素选择**: 鼠标悬停高亮显示页面元素
- **精确截图**: 自动捕获选中元素的截图
- **元素信息提取**: 自动提取元素的标签、类名、文本、属性等信息
- **XPath和CSS选择器生成**: 自动生成元素的定位信息

### 🔗 MCP服务集成
- **WebSocket连接**: 与本地MCP服务器实时通信
- **数据传输**: 将捕获的元素信息和截图发送给AI服务
- **反馈机制**: 接收AI处理结果和指令

### 🎨 用户友好界面
- **现代化UI**: 美观的弹出界面和交互体验
- **实时状态显示**: 连接状态和操作进度可视化
- **快捷操作**: 一键开始元素捕获和全页截图

### ⚙️ 灵活配置
- **MCP端口设置**: 可配置MCP服务器端口
- **自动高亮开关**: 可选择是否自动高亮悬停元素
- **数据持久化**: 设置自动保存到Chrome存储

## 安装方法

### 开发者模式安装

1. **打开Chrome扩展管理页面**
   - 在Chrome地址栏输入: `chrome://extensions/`
   - 或者通过菜单: 更多工具 → 扩展程序

2. **启用开发者模式**
   - 在扩展程序页面右上角，打开"开发者模式"开关

3. **加载扩展程序**
   - 点击"加载已解压的扩展程序"
   - 选择 `chrome-extension` 文件夹
   - 点击"选择文件夹"

4. **确认安装**
   - 扩展程序列表中应该出现"Instant Snap"
   - 浏览器工具栏会显示插件图标

## 使用方法

### 1. 启动MCP服务

首先需要启动MCP服务器（默认端口8765）:

```bash
# 在项目根目录
node index.js
```

### 2. 配置插件

1. 点击浏览器工具栏中的Instant Snap图标
2. 在弹出的界面中检查MCP连接状态
3. 如需要，可以修改MCP端口设置
4. 确保连接状态显示为"Connected to MCP"

### 3. 捕获元素

#### 方法一：元素选择捕获
1. 点击"📸 Start Element Capture"按钮
2. 鼠标悬停在页面元素上会看到高亮效果
3. 点击想要捕获的元素
4. 在弹出界面中查看捕获结果
5. 输入操作指令，点击"Send to AI"

#### 方法二：全页截图
1. 点击"🖼️ Full Page Screenshot"按钮
2. 插件会自动捕获当前页面的可见区域
3. 截图会直接发送给MCP服务

### 4. AI交互

1. **输入指令**: 在"What do you want to do with this element?"文本框中输入自然语言指令
2. **发送数据**: 点击"Send to AI"按钮
3. **查看结果**: AI处理结果会通过MCP服务返回

## 界面说明

### 主界面元素

- **连接状态指示器**: 显示与MCP服务的连接状态
  - 🟢 绿色: 已连接
  - 🟡 黄色: 连接中
  - 🔴 红色: 连接失败

- **控制按钮**:
  - "📸 Start Element Capture": 开始元素选择模式
  - "🖼️ Full Page Screenshot": 捕获全页截图

- **设置选项**:
  - "MCP Port": MCP服务器端口（默认8765）
  - "Auto Highlight": 自动高亮悬停元素

- **捕获预览区域**: 显示捕获的元素信息和截图

### 元素选择模式

进入元素选择模式后:
- 页面会显示半透明遮罩
- 顶部显示操作提示
- 鼠标悬停元素会高亮显示
- 显示元素信息工具提示
- 按ESC键可以取消选择

## 快捷键

- **ESC**: 取消元素选择模式
- **点击**: 选择并捕获元素

## 故障排除

### 连接问题

**问题**: MCP连接失败
**解决方案**:
1. 确保MCP服务器正在运行
2. 检查端口设置是否正确
3. 确认防火墙没有阻止连接
4. 尝试重启浏览器和MCP服务

### 元素捕获问题

**问题**: 无法选择元素
**解决方案**:
1. 刷新页面后重试
2. 检查页面是否有JavaScript错误
3. 确保没有其他扩展程序冲突
4. 尝试在无痕模式下使用

### 权限问题

**问题**: 插件无法在某些页面工作
**解决方案**:
1. 某些特殊页面（如chrome://）不支持扩展程序
2. 确保插件有足够的权限
3. 检查网站的内容安全策略

## 技术架构

### 文件结构
```
chrome-extension/
├── manifest.json          # 扩展程序清单
├── popup.html             # 弹出界面HTML
├── popup.css              # 弹出界面样式
├── popup.js               # 弹出界面逻辑
├── background.js          # 后台服务脚本
├── content.js             # 内容脚本
├── icons/                 # 图标文件
│   └── icon.svg
└── README.md              # 说明文档
```

### 组件说明

- **Manifest**: 定义扩展程序的基本信息和权限
- **Popup**: 用户交互界面，处理用户操作和设置
- **Background**: 后台服务，处理截图和消息传递
- **Content**: 页面内容脚本，负责元素选择和高亮

### 通信流程

1. **用户操作** → Popup界面
2. **Popup** → Background脚本（通过chrome.runtime.sendMessage）
3. **Background** → Content脚本（通过chrome.tabs.sendMessage）
4. **Content** → 页面元素交互
5. **Background** → MCP服务（通过WebSocket）
6. **MCP服务** → AI处理
7. **AI结果** → 用户界面

## 开发说明

### 本地开发

1. 修改代码后，在Chrome扩展管理页面点击刷新按钮
2. 对于content script的修改，需要刷新目标页面
3. 使用Chrome开发者工具调试

### 调试方法

- **Popup调试**: 右键点击插件图标 → 检查弹出内容
- **Background调试**: 扩展管理页面 → 检查视图：背景页
- **Content调试**: 在目标页面按F12，查看Console

## 版本历史

### v1.0.0
- 初始版本发布
- 基本的元素捕获功能
- MCP服务集成
- 用户界面实现

## 许可证

MIT License

## 贡献

欢迎提交Issue和Pull Request来改进这个项目。

## 联系方式

如有问题或建议，请通过GitHub Issues联系我们。